<template name="loginButtons">
  {{#if currentUser}}
    {{#unless loggingIn}}
      {{#with currentUser}}
        {{>logOutDropdown}}
      {{/with}}
    {{/unless}}
  {{else}}
    {{>logInDropdown}}
  {{/if}}
</template>

<template name="logOutDropdown">
  <li id="login-dropdown-list" class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown">
      {{{profile.firstName}}} {{{profile.lastName}}}
      <b class="caret"></b>
    </a>
    <div class="dropdown-menu">
      {{>loginButtonsMessages}}
      {{#unless inMessageOnlyFlow}}
        {{#if inChangePasswordFlow}}
          {{>changePasswordForm}}
        {{else}} {{#if inEditProfileFlow}}
          {{>editProfileForm}}
        {{else}}
          <button class="btn btn-primary btn-block" id="login-buttons-edit-profile">Edit Profile</button>
          <button class="btn btn-primary btn-block" id="login-buttons-open-change-password">Change Password</button>
          <button class="btn btn-block btn-primary" id="login-buttons-logout">Sign out</button>
        {{/if}} {{/if}}
      {{else}}
        <button class="btn btn-block btn-primary" id="login-buttons-logout-message-only-OK">OK</button>
      {{/unless}}
    </div>
  </li>
</template>

<template name="logInDropdown">
  <li id="login-dropdown-list" class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown">
      Sign in/Join
      <b class="caret"></b>
    </a>
    <div class="dropdown-menu">
      {{>loginButtonsMessages}}
      {{#unless inMessageOnlyFlow}}
        {{#if inSignupFlow}}
          {{>createAccountForm}}
        {{else}}
          {{#if inForgotPasswordFlow}}
            {{>forgotPasswordForm}}
          {{else}}
            {{>loginForm}}
          {{/if}}
        {{/if}}
      {{else}}
        <button class="btn btn-block btn-primary" id="login-buttons-message-only-OK">OK</button>
      {{/unless}}
    </div>
  </li>
</template>

<template name="loginForm">
  <input id="login-username-or-email" type="usernameOrEmail" placeholder="Username or Email" class="form-control" />
  <input id="login-password" type="password" placeholder="Password" class="form-control" />

  <button class="btn btn-primary col-xs-12 col-sm-12" id="login-buttons-signin" type="button">Sign in</button>

  <div id="login-other-options">
    <a id="forgot-password-link" class="pull-left" >Forgot password?</a>
    <a id="signup-link" class="pull-right" >Create account</a>
  </div>
</template>

<template name="createAccountForm">
  <input id="login-create-firstname" type="text" placeholder="First name" class="form-control" />
  <input id="login-create-lastname" type="text" placeholder="Last name" class="form-control" />
  <input id="login-create-username" type="text" placeholder="Username" class="form-control" />
  <input id="login-create-email" type="email" placeholder="Email" class="form-control" />
<!--  <input id="login-create-password" type="password" placeholder="Password" class="form-control" />
  <input id="login-create-password-again" type="password" placeholder="Confirm Password" class="form-control" />-->
  <select id="login-create-role" type="role" class="form-control" required>
    <option value="" selected disabled>Choose role</option>
    <option value="student">Student</option>
    <option value="teacher">Teacher</option>
    <option value="parentOrAdvisor">Parent or Advisor</option>
  </select>
  <select id="login-create-section" type="section" class="form-control hidden" required>
    <option value="" selected disabled>Choose section</option>
    {{#each sections}}
      <option value="{{_id}}">{{{section}}}</option>
    {{/each}}
  </select>
  <div id="login-create-choose-students" class="hidden">
    <p>Please enter the names of students you would like to observe.</p>
    {{#each students}}
      <input class="form-control login-create-choose-student" type="student" value="{{name}}" placeholder="Firstname Lastname <Enter>"/>
    {{/each}}
    <input class="form-control login-create-choose-student" type="student" placeholder="Firstname Lastname <Enter>"  />
  </div>

  <button class="btn btn-primary col-xs-12 col-sm-12" id="login-buttons-create" type="button">Create</button>
  <button class="btn btn-primary col-xs-12 col-sm-12" id="login-buttons-cancel-create" type="button">Cancel</button>
</template>

<template name="forgotPasswordForm">
  <div class="login-form">

      <input id="forgot-password-email" type="email" placeholder="Email" class="form-control" />

    <button class="btn btn-primary login-button-form-submit col-xs-12 col-sm-12" id="login-buttons-forgot-password">Reset password</button>
    <button class="btn btn-primary col-xs-12 col-sm-12" id="login-buttons-cancel-forgot-password" type="button">Cancel</button>
  </div>
</template>

<template name="changePasswordForm">
  <div class="login-form">
    <input id="change-password-old" type="password" placeholder="Current password" class="form-control" />
    <input id="change-password-new" type="password" placeholder="New password" class="form-control" />
    <input id="change-password-new-again" type="password" placeholder="New password (again)" class="form-control" />

    <button class="btn btn-block btn-primary" id="login-buttons-do-change-password">Change password</button>
    <button class="btn btn-block btn-primary" id="login-buttons-cancel-change-password">Return</button>
  </div>
</template>

<template name="editProfileForm">
  <div class="form-group">
    Name: <input id="edit-profile-firstname" type="text" value={{profile.firstName}} class="form-control" />
    <input id="edit-profile-lastname" type="text" value={{profile.lastName}} class="form-control" />
  </div> 
  <div class="form-group">
    Username: 
    <input id="edit-profile-username" type="text" value={{username}} class="form-control" />
  </div>
  <div class="form-group">
    Email: 
    {{#each emails}}
      <p>
        {{address}}
        {{#unless verified}}
            <a href="#" class="glyphicon glyphicon-remove remove-email" title="stop observing"></a>
        {{/unless}}
      </p>
    {{/each}}
    {{#each newEmails}}
      <input class="form-control edit-profile-add-email" type="email" value="{{address}}" placeholder="Add another email."/>
    {{/each}}
    <input class="form-control edit-profile-add-email" type="email" placeholder='Add another email.'>
  </div>
  {{#if isInRole 'teacher'}} <!-- and if viewing as another user -->
    <select id="edit-profile-role" type="role" class="form-control" required>
      <option value="student" {{roleSelected 'student'}}>Student</option>
      <option value="teacher" {{roleSelected 'teacher'}}>Teacher</option>
      <option value="parentOrAdvisor" {{roleSelected 'parentOrAdvisor'}}>Parent or Advisor</option>
    </select>
  {{/if}}
  {{#if isInRole 'student'}}
    Section:
    <select id="edit-profile-section" type="section" class="form-control" required>
        <option value="" {{noSectionSelected}} disabled>Choose section</option>
      {{#each sections}}
        <option value="{{_id}}" {{sectionSelected}}>{{{section}}}</option>
      {{/each}}
    </select>
  {{/if}}
  {{#if isInRole 'parentOrAdvisor'}}
    <div class="form-group">
      Students you are observing:
      {{#each verifiedStudents}}
        <p> 
          {{name}} 
          <a href="#" class="glyphicon glyphicon-remove stop-observing" title="stop observing"></a>
        </p>
      {{/each}}

      {{#if unverifiedStudents}}
        Requests pending approval: 
        {{#each unverifiedStudents}}
          <p> 
            {{name}} 
            <a href="#" class="glyphicon glyphicon-remove stop-observing" title="stop observing"></a>  
          </p>  
        {{/each}}
      {{/if}}
      {{#each newStudents}}
        <input class="form-control edit-profile-choose-student" type="student" value="{{name}}" placeholder="Firstname Lastname <Enter>"/>
      {{/each}}
      <input class="form-control edit-profile-choose-student" type="student" placeholder="Firstname Lastname <Enter>"  />
    </div>
  {{/if}}


  <button class="btn btn-primary col-xs-12 col-sm-12" id="edit-profile-save" type="button">Save Changes</button>
  <button class="btn btn-primary col-xs-12 col-sm-12" id="edit-profile-cancel" type="button">Return</button>
</template>

<!-- used in various places to display messages to user -->
<template name="loginButtonsMessages">
  {{#if errorMessage}}
    <div class="alert alert-danger">{{errorMessage}}</div>
  {{/if}}
  {{#if infoMessage}}
    <div class="alert alert-success no-margin">{{infoMessage}}</div>
  {{/if}}
</template>