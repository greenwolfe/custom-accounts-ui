<template name="loginButtons">
  {{#if currentUser}}
    {{#unless loggingIn}}
      {{#with currentUser}}
        {{>logOutDropdown}}
      {{/with}}
    {{/unless}}
  {{else}}
    {{>logInDropdown}}
  {{/if}}
</template>

<template name="logOutDropdown">
  <li id="login-dropdown-list" class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown">
      {{{profile.firstName}}} {{{profile.lastName}}}
      <b class="caret"></b>
    </a>
    <div class="dropdown-menu">
      {{>loginButtonsMessages}}
      {{#unless inMessageOnlyFlow}}
        {{#if inChangePasswordFlow}}
          {{>changePasswordForm}}
        {{else}}
          <button class="btn btn-default btn-block" id="login-buttons-open-change-password">Change Password</button>
          <button class="btn btn-block btn-primary" id="login-buttons-logout">Sign out</button>
        {{/if}}
      {{else}}
        <button class="btn btn-block btn-primary" id="login-buttons-logout-message-only-OK">OK</button>
      {{/unless}}
    </div>
  </li>
</template>

<template name="logInDropdown">
  <li id="login-dropdown-list" class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown">
      Sign in/Join
      <b class="caret"></b>
    </a>
    <div class="dropdown-menu">
      {{>loginButtonsMessages}}
      {{#unless inMessageOnlyFlow}}
        {{#if inSignupFlow}}
          {{>createAccountForm}}
        {{else}}
          {{#if inForgotPasswordFlow}}
            {{>forgotPasswordForm}}
          {{else}}
            {{>loginForm}}
          {{/if}}
        {{/if}}
      {{else}}
        <button class="btn btn-block btn-primary" id="login-buttons-message-only-OK">OK</button>
      {{/unless}}
    </div>
  </li>
</template>

<template name="loginForm">
  <input id="login-username-or-email" type="usernameOrEmail" placeholder="Username or Email" class="form-control" />
  <input id="login-password" type="password" placeholder="Password" class="form-control" />

  <button class="btn btn-primary col-xs-12 col-sm-12" id="login-buttons-signin" type="button">Sign in</button>

  <div id="login-other-options">
    <a id="forgot-password-link" class="pull-left" >Forgot password?</a>
    <a id="signup-link" class="pull-right" >Create account</a>
  </div>
</template>

<template name="createAccountForm">
  <input id="login-create-firstname" type="text" placeholder="First name" class="form-control" />
  <input id="login-create-lastname" type="text" placeholder="Last name" class="form-control" />
  <input id="login-create-username" type="text" placeholder="Username" class="form-control" />
  <input id="login-create-email" type="email" placeholder="Email" class="form-control" />
<!--  <input id="login-create-password" type="password" placeholder="Password" class="form-control" />
  <input id="login-create-password-again" type="password" placeholder="Confirm Password" class="form-control" />-->
  <select id="login-create-role" type="role" class="form-control" required>
    <option value="" selected disabled>Choose role</option>
    <option value="student">Student</option>
    <option value="teacher">Teacher</option>
    <option value="parentOrAdvisor">Parent or Advisor</option>
  </select>
  <select id="login-create-section" type="section" class="form-control hidden" required>
    <option value="" selected disabled>Choose section</option>
    {{#each sections}}
      <option value="{{_id}}">{{{section}}}</option>
    {{/each}}
  </select>
  <div id="login-create-choose-students" class="hidden">
    <p>Please enter the names of students you would like to observe.</p>
    <input class="form-control login-create-choose-student" type="student" placeholder="Firstname Lastname <Enter>"  />
    {{#each students}}
      <input class="form-control login-create-choose-student" type="student" value="{{name}}" placeholder="Firstname Lastname <Enter>"/>
    {{/each}}
  </div>


  <button class="btn btn-primary col-xs-12 col-sm-12" id="login-buttons-create" type="button">Create</button>
  <button class="btn btn-primary col-xs-12 col-sm-12" id="login-buttons-cancel-create" type="button">Cancel</button>
</template>

<template name="forgotPasswordForm">
  <div class="login-form">

      <input id="forgot-password-email" type="email" placeholder="Email" class="form-control" />

    <button class="btn btn-primary login-button-form-submit col-xs-12 col-sm-12" id="login-buttons-forgot-password">Reset password</button>
    <button class="btn btn-primary col-xs-12 col-sm-12" id="login-buttons-cancel-forgot-password" type="button">Cancel</button>
  </div>
</template>

<template name="changePasswordForm">
  <div class="login-form">
    <input id="change-password-old" type="password" placeholder="Current password" class="form-control" />
    <input id="change-password-new" type="password" placeholder="New password" class="form-control" />
    <input id="change-password-new-again" type="password" placeholder="New password (again)" class="form-control" />

    <button class="btn btn-block btn-primary" id="login-buttons-do-change-password">Change password</button>
    <button class="btn btn-block btn-default" id="login-buttons-cancel-change-password">Cancel</button>
  </div>
</template>

<!-- used in various places to display messages to user -->
<template name="loginButtonsMessages">
  {{#if errorMessage}}
    <div class="alert alert-danger">{{errorMessage}}</div>
  {{/if}}
  {{#if infoMessage}}
    <div class="alert alert-success no-margin">{{infoMessage}}</div>
  {{/if}}
</template>